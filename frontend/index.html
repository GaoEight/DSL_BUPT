<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>DSL 客服机器人</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
}

.container {
    background: #fff;
    padding: 20px 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 500px;
}

h2 {
    text-align: center;
    color: #333;
}

form {
    margin-top: 20px;
}

input, select, button {
    display: block;
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 14px;
}

button {
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
}

button:hover {
    background-color: #45a049;
}

.hidden { display: none; }

#chatContainer {
    margin-top: 20px;
}

#chatBox {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    height: 300px;
    overflow-y: auto;
    background: #f9f9f9;
    white-space: pre-wrap; /* 支持换行 */
}

.user-msg {
    text-align: right;
    color: #2b6cb0;
    margin: 5px 0;
}

.bot-msg {
    text-align: left;
    color: #38a169;
    margin: 5px 0;
}

p { font-size: 14px; text-align: center; }
a { color: #3182ce; text-decoration: none; cursor: pointer; }
a:hover { text-decoration: underline; }

</style>
</head>
<body>

<div class="container">
    <h2 id="pageTitle">登录</h2>

    <!-- 登录表单 -->
    <form id="loginForm">
        <input type="text" name="name" placeholder="姓名" required>
        <input type="password" name="pass" placeholder="密码" required>
        <select name="role">
            <option value="student">学生</option>
            <option value="teacher">老师</option>
        </select>
        <button type="submit">登录</button>
        <p>没有账号？<a id="showRegister">去注册</a></p>
    </form>

    <!-- 注册表单 -->
    <form id="registerForm" class="hidden">
        <input type="text" name="name" placeholder="姓名" required>
        <input type="password" name="pass" placeholder="密码" required>
        <input type="email" name="email" placeholder="邮箱" required>
        <select name="role">
            <option value="student">学生</option>
            <option value="teacher">老师</option>
        </select>
        <button type="submit">注册</button>
        <p>已有账号？<a id="showLogin">去登录</a></p>
    </form>

    <!-- 聊天界面 -->
    <div id="chatContainer" class="hidden">
        <div id="chatBox"></div>
        <input type="text" id="chatInput" placeholder="输入消息..." autocomplete="off">
        <button id="sendBtn">发送</button>
    </div>
</div>

<script>
// 切换登录/注册
document.querySelector("#showRegister").addEventListener("click", e => {
    e.preventDefault();
    document.querySelector("#loginForm").classList.add("hidden");
    document.querySelector("#registerForm").classList.remove("hidden");
    document.querySelector("#pageTitle").textContent = "注册";
});
document.querySelector("#showLogin").addEventListener("click", e => {
    e.preventDefault();
    document.querySelector("#registerForm").classList.add("hidden");
    document.querySelector("#loginForm").classList.remove("hidden");
    document.querySelector("#pageTitle").textContent = "登录";
});

// 登录提交
document.querySelector("#loginForm").addEventListener("submit", async e => {
    e.preventDefault();
    const form = e.target;
    const data = {
        name: form.name.value,
        pass: form.pass.value,
        role: form.role.value
    };
    const res = await fetch("/api/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.success) {
        alert("登录成功！");
        document.querySelector("#loginForm").classList.add("hidden");
        document.querySelector("#chatContainer").classList.remove("hidden");
    } else {
        alert("登录失败：" + result.message);
    }
});

// 注册提交
document.querySelector("#registerForm").addEventListener("submit", async e => {
    e.preventDefault();
    const form = e.target;
    const data = {
        name: form.name.value,
        pass: form.pass.value,
        email: form.email.value,
        role: form.role.value
    };
    const res = await fetch("/api/register", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });
    const result = await res.json();
    if (result.success) {
        alert("注册成功！");
        document.querySelector("#registerForm").classList.add("hidden");
        document.querySelector("#loginForm").classList.remove("hidden");
    } else {
        alert("注册失败：" + result.message);
    }
});

// 聊天发送
document.querySelector("#sendBtn").addEventListener("click", async () => {
    const input = document.querySelector("#chatInput");
    const msg = input.value.trim();
    if (!msg) return;
    input.value = "";

    // 发给 API
    const res = await fetch("/api/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({msg})
    });
    const result = await res.json();

    const chatBox = document.querySelector("#chatBox");
    // 分行显示：用户消息一行，客服消息一行
    chatBox.innerHTML += `<div class="user-msg">${msg}</div>\n<div class="bot-msg">${result.reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
});
</script>

</body>
</html>
